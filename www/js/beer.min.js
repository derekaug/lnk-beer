var beer={bounds:null,default_latlng:new google.maps.LatLng(GLOBALS.center_lat,GLOBALS.center_lng),init:function(){var a=this;a.$beer_map=$("#beer-map"),a.$updated_time=$("#update-time"),a.$loading=$("#loading"),a.template_checkin=$("#template-checkin").html(),a.$updated_time.text(moment.utc(a.$updated_time.text()).local().format("LLL")),a.initMap(),a.fillMap()},initMap:function(){var a=this;a.map=new google.maps.Map(a.$beer_map.get(0),{center:a.default_latlng,zoom:10}),$(window).on("resize",function(){null!==a.bounds&&a.map.fitBounds(a.bounds);var b=a.map.getCenter();google.maps.event.trigger(a.map,"resize"),a.map.setCenter(b)})},fillMap:function(){var a=this,b={url:"img/beer.png",size:new google.maps.Size(16,24),scaledSize:new google.maps.Size(16,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,24)};$.ajax({url:"service/get_checkins.phpa",dataType:"json",success:function(c){if(c&&c.response&&c.response.checkins){a.bounds=new google.maps.LatLngBounds;var d=c.response.checkins.items;$.each(d,function(c,d){var e=new google.maps.LatLng(d.venue.location.lat,d.venue.location.lng),f=new google.maps.Marker({position:e,map:a.map,icon:b,title:d.beer.beer_name+" - "+d.beer.beer_style}),g=$(Mustache.render(a.template_checkin,d)),h=g.find(".time");h.text(moment.utc(h.text(),"ddd, DD MMM YYYY HH:mm:ss ZZ").local().fromNow());var i=new google.maps.InfoWindow({position:e,content:g.get(0).outerHTML}),j=function(b,c){b.open(a.map,c)};google.maps.event.addListener(f,"click",j.bind(this,i,f)),a.bounds.extend(e)}),a.map.fitBounds(a.bounds)}},error:function(){window.alert("There was a problem getting recent beer check-ins, please reload the page and to try again.")},complete:function(){a.$loading.fadeOut()}})}};$(function(){beer.init()});